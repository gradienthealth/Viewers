"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[953],{27953:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var s=n(32735),r=n(60216),a=n.n(r),i=n(72928),l=n(84334),o=n(38942),c=n(94709),u=n(43194),d=n(40841),p=n.n(d);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},m.apply(this,arguments)}const{formatDate:S}=i.ZP;function g(e){const{children:t,dataSource:n,displaySets:r,viewportIndex:a,viewportLabel:i,servicesManager:d,extensionManager:g}=e,{t:f}=(0,o.$G)("SRViewport"),{DisplaySetService:h,CornerstoneViewportService:y}=d.services;if(r.length>1)throw new Error("SR viewport should only have a single display set");const I=r[0],[x,b]=(0,u.useViewportGrid)(),[w,E]=(0,u.useViewportDialog)(),[D,v]=(0,s.useState)(0),[k,P]=(0,s.useState)(1),[C,M]=(0,s.useState)(null),[N,T]=(0,s.useState)(null),[U,R]=(0,s.useState)(I.isHydrated),[O,V]=(0,s.useState)(null),{viewports:j,activeViewportIndex:A}=x;let B,L;if(g.registeredExtensionIds.includes("@ohif/extension-measurement-tracking")){const e=g.getModuleEntry("@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext"),t=()=>(0,s.useContext)(e.context);[B,L]=t()}const F=(0,s.useCallback)((e=>{const{measurements:t}=I;(0,c.l2)(O,t.map((e=>e.TrackingUniqueIdentifier)),e)}),[O,D,I]),_=e=>{V(e.detail.element)},G=(0,s.useCallback)((e=>{const{StudyInstanceUID:t,displaySetInstanceUID:n,sopClassUids:s}=I;t&&n&&(s&&s.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported."),async function(e,t,n){const{measurements:s}=e,r=s[t],{displaySetInstanceUID:a}=r,i=n.getDisplaySetByUID(a),l=i.images[0],o={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices};return{referencedDisplaySetMetadata:o,referencedDisplaySet:i}}(I,e,h).then((t=>{let{referencedDisplaySet:n,referencedDisplaySetMetadata:s}=t;if(v(e),M(n),T(s),n.displaySetInstanceUID===C?.displaySetInstanceUID){const{measurements:t}=I,n=y.getViewportInfoByIndex(a),s=y.getCornerstoneViewport(n.getViewportId()),r=s.getImageIds().indexOf(t[e].imageId);-1!==r&&s.setImageIdIndex(r)}})))}),[n,I,C,a]),H=(0,s.useCallback)((()=>{if(!C)return null;const{component:t}=g.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{measurements:n}=I,r=n[D];if(!r)return null;const a=C.images.findIndex((e=>e.imageId===r.imageId));return s.createElement(t,m({},e,{displaySets:[C],viewportOptions:{toolGroupId:"SRToolGroup"},onElementEnabled:_,initialImageIndex:a}))}),[C,a,D]),$=(0,s.useCallback)((e=>{let t=D;"right"===e?(t++,t>=k&&(t=0)):(t--,t<0&&(t=k-1)),F(t),G(t)}),[D,k,G,F]);(0,s.useEffect)((()=>{const e=h.subscribe(h.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=j[A];t.includes(n.displaySetInstanceUID)&&b.setDisplaySetsForViewport({viewportIndex:A,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{I.isLoaded||I.load(),R(I.isHydrated);const e=I.measurements.length;P(e)}),[I]),(0,s.useEffect)((()=>{O&&I.isLoaded&&F(D)}),[D,O,F,I]);let q=B?.context?.trackedSeries?.length>0;(0,s.useEffect)((()=>{q=B?.context?.trackedSeries?.length>0}),[B]),(0,s.useEffect)((()=>{G(D)}),[n,I]);let Y=null;if(!C||!N)return null;t&&t.length&&(Y=t.map(((e,t)=>e&&s.cloneElement(e,{viewportIndex:a,key:t}))));const{PatientID:Z,PatientName:z,PatientSex:J,PatientAge:K,SliceThickness:Q,ManufacturerModelName:W,StudyDate:X,SeriesDescription:ee,SpacingBetweenSlices:te,SeriesNumber:ne}=N;return s.createElement(s.Fragment,null,s.createElement(u.ViewportActionBar,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:$,getStatusComponent:()=>function(e){let{srDisplaySet:t,viewportIndex:n,isRehydratable:r,isLocked:a,sendTrackedMeasurementsEvent:i}=e;const l=()=>{i("RESTORE_PROMPT_HYDRATE_SR",{displaySetInstanceUID:t.displaySetInstanceUID,viewportIndex:n})},o=r&&!a?3:r&&a?2:1;let c=null,d=null;switch(o){case 1:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 rounded-full",style:{width:"18px",height:"18px",backgroundColor:"#98e5c1",border:"solid 1.5px #000000"}},s.createElement(u.Icon,{name:"exclamation",style:{color:"#000",width:"12px",height:"12px"}})),c=()=>s.createElement("div",null,"This structured report is not compatible",s.createElement("br",null),"with this application.");break;case 2:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 bg-black rounded-full",style:{width:"18px",height:"18px"}},s.createElement(u.Icon,{name:"lock",style:{color:"#05D97C",width:"8px",height:"11px"}})),c=()=>s.createElement("div",null,"This structured report is currently read-only",s.createElement("br",null),"because you are tracking measurements in",s.createElement("br",null),"another viewport.");break;case 3:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 bg-white rounded-full group-hover:bg-customblue-200",style:{width:"18px",height:"18px",border:"solid 1.5px #000000"}},s.createElement(u.Icon,{name:"arrow-left",style:{color:"#000",width:"14px",height:"14px"}})),c=()=>s.createElement("div",null,"Click to restore measurements.")}const m=()=>s.createElement("div",{className:p()("group relative flex items-center justify-center px-2 rounded-full cursor-default bg-customgreen-100",{"hover:bg-customblue-100":3===o,"cursor-pointer":3===o}),style:{height:"24px",width:"55px"},onClick:()=>{3===o&&l&&l()}},s.createElement("span",{className:"pr-1 text-lg font-bold leading-none text-black"},"SR"),s.createElement(d,null));return s.createElement(s.Fragment,null,c&&s.createElement(u.Tooltip,{content:s.createElement(c,null),position:"bottom-left"},s.createElement(m,null)),!c&&s.createElement(m,null))}({srDisplaySet:I,viewportIndex:a,isTracked:!1,isRehydratable:I.isRehydratable,isLocked:q,sendTrackedMeasurementsEvent:L}),studyData:{label:i,useAltStyling:!0,studyDate:S(X),currentSeries:ne,seriesDescription:ee,patientInformation:{patientName:z?l.ZP.utils.formatPN(z.Alphabetic):"",patientSex:J||"",patientAge:K||"",MRN:Z||"",thickness:Q?`${Q.toFixed(2)}mm`:"",spacing:void 0!==te?`${te.toFixed(2)}mm`:"",scanner:W||""}}}),s.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},H(),s.createElement("div",{className:"absolute w-full"},w.viewportIndex===a&&s.createElement(u.Notification,{message:w.message,type:w.type,actions:w.actions,onSubmit:w.onSubmit,onOutsideClick:w.onOutsideClick})),Y))}g.propTypes={displaySets:a().arrayOf(a().object),viewportIndex:a().number.isRequired,dataSource:a().object,children:a().node,customProps:a().object},g.defaultProps={customProps:{}};const f=g}}]);
//# sourceMappingURL=953.bundle.b246726ffc4e98528bb6.js.map